<%- include('./partials/header') %>

<style>
  .table-black-bordered {
    border: 1px solid black !important;
  }
  .table-black-bordered th,
  .table-black-bordered td {
    border: 1px solid black !important;
  }
</style>
<div class="pcoded-main-container">
  <div class="pcoded-content">
    <div class="page-header">
      <div class="page-block">
        <div class="row align-items-center">
          <div class="col-md-12">
            <div class="page-header-title">
              <h5 class="m-b-10">Danh sách bệnh nhân</h5>
            </div>
            <ul class="breadcrumb">
              <li class="breadcrumb-item"><a href="/doctor"><i class="feather icon-home"></i></a></li>
              <li class="breadcrumb-item"><a>Hồ sơ bệnh nhân</a></li>
              <li class="breadcrumb-item"><a>Danh sách bệnh nhân</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <div class="card">
          <div class="card-body">
            <!-- Thanh tìm kiếm -->
            <form class="row g-3 mb-4 justify-content-end" method="get" action="/doctor/patients">
              <div class="col-md-4">
                <div class="position-relative">
                  <input type="text" name="keyword" id="keyword-input" value="<%= keyword || '' %>"
                  placeholder="Tìm theo tên, email, số điện thoại, mã BN..." class="form-control" />
                </div>
              </div>
              <div class="col-md-3">
                <div class="input-group">
                  <span class="input-group-text">Từ</span>
                  <input type="date" name="fromDate" value="<%= fromDate || '' %>" class="form-control" />
                </div>
              </div>
              <div class="col-md-3">
                <div class="input-group">
                  <span class="input-group-text">Đến</span>
                  <input type="date" name="toDate" value="<%= toDate || '' %>" class="form-control" />
                </div>
              </div>
              <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Tìm kiếm</button>
              </div>
            </form>

            <!-- Bảng danh sách -->
            <div class="table-responsive">
              <table class="table table-striped table-bordered align-middle table-black-bordered">
                <thead class="table-dark">
                  <tr>
                    <th>Mã BN</th>
                    <th>Họ tên</th>
                    <th>Giới tính</th>
                    <th>Ngày sinh</th>
                    <th>Email</th>
                    <th>Số điện thoại</th>
                    <th>Ngày tạo</th>
                    <th>Hành động</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (patients.length === 0) { %>
                  <tr>
                    <td colspan="8" class="text-center">Không tìm thấy bệnh nhân nào</td>
                  </tr>
                  <% } %>
                  <% patients.forEach(p => { %>
                  <tr>
                    <td><%= p.patientCode || 'N/A' %></td>
                    <td><%= p.fullname %></td>
                    <td><%= p.gender %></td>
                    <td><%= p.birthday ? p.birthday.toLocaleDateString('vi-VN') : '' %></td>
                    <td><%= p.email %></td>
                    <td><%= p.phone %></td>
                    <td><%= p.created_at.toLocaleDateString('vi-VN') %></td>
                    <td>
                      <a href="/doctor/patient/<%= p._id %>" class="btn btn-sm btn-info" title="Xem chi tiết bệnh nhân">Xem chi tiết</a>
                      <a href="/doctor/medical-records/create?patientId=<%= p._id %>" class="btn btn-sm btn-success" title="Tạo bệnh án mới">Tạo bệnh án mới</i></a>
                    </td>
                  </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('./partials/footer') %>
