<%- include('./partials/header') %>

<style>
  .table-black-bordered {
    border: 1px solid black !important;
  }
  .table-black-bordered th,
  .table-black-bordered td {
    border: 1px solid black !important;
  }
  .patient-info-card .card-body {
    font-size: 1rem;
  }
  .patient-info-card .info-label {
    font-weight: bold;
    color: #333;
  }
  .patient-info-card .info-value {
    color: #555;
  }
</style>

<div class="pcoded-main-container">
  <div class="pcoded-content">
    <div class="page-header">
      <div class="page-block">
        <div class="row align-items-center">
          <div class="col-md-12">
            <div class="page-header-title">
              <h5 class="m-b-10">
                Chi tiết bệnh nhân: <%= patient.fullname %> (<%=patient.patientCode %>)
              </h5>
            </div>
            <ul class="breadcrumb">
              <li class="breadcrumb-item">
                <a href="/doctor"><i class="feather icon-home"></i></a>
              </li>
              <li class="breadcrumb-item">
                <a href="/doctor/patients">Danh sách bệnh nhân</a>
              </li>
              <li class="breadcrumb-item"><a>Chi tiết bệnh nhân</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Thông tin bệnh nhân -->
    <div class="row">
      <div class="col-sm-12">
        <div class="card patient-info-card">
          <div class="card-header">
            <h5><i class="feather icon-user mr-2"></i>Thông tin cá nhân</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <p>
                  <span class="info-label">Họ tên:</span>
                  <span class="info-value"><%= patient.fullname %></span>
                </p>
                <p>
                  <span class="info-label">Mã bệnh nhân:</span>
                  <span class="info-value"><%= patient.patientCode %></span>
                </p>
                <p>
                  <span class="info-label">Giới tính:</span>
                  <span class="info-value"><%= patient.gender %></span>
                </p>
                <p>
                  <span class="info-label">Ngày sinh:</span>
                  <span class="info-value"
                    ><%= patient.birthday ?
                    patient.birthday.toLocaleDateString('vi-VN') : 'Không có'%></span
                  >
                </p>
                <p>
                  <span class="info-label">Email:</span>
                  <span class="info-value"
                    ><%= patient.email || 'Không có' %></span
                  >
                </p>
                <p>
                  <span class="info-label">Số điện thoại:</span>
                  <span class="info-value"
                    ><%= patient.phone || 'Không có' %></span
                  >
                </p>
              </div>
              <div class="col-md-6">
                <p>
                  <span class="info-label">Địa chỉ:</span>
                  <span class="info-value"
                    ><%= patient.address || 'Không có' %></span
                  >
                </p>
                <p>
                  <span class="info-label">CMND/CCCD:</span>
                  <span class="info-value"
                    ><%= patient.identificationNumber || 'Không có' %></span
                  >
                </p>
                <p>
                  <span class="info-label">Nhóm máu:</span>
                  <span class="info-value"
                    ><%= patient.bloodType || 'Không có' %></span
                  >
                </p>
                <p>
                  <span class="info-label">Dị ứng:</span>
                  <span class="info-value"
                    ><%= patient.allergies || 'Không có' %></span
                  >
                </p>
                <p>
                  <span class="info-label">Bệnh mãn tính:</span>
                  <span class="info-value"
                    ><%= patient.chronicDiseases || 'Không có' %></span
                  >
                </p>
              </div>
            </div>
            <hr />
            <h6>Thông tin người giám hộ</h6>
            <div class="row">
              <div class="col-md-6">
                <p>
                  <span class="info-label">Họ tên:</span>
                  <span class="info-value"
                    ><%= patient.guardianName || 'Không có' %></span
                  >
                </p>
                <p>
                  <span class="info-label">Số điện thoại:</span>
                  <span class="info-value"
                    ><%= patient.guardianPhone || 'Không có' %></span
                  >
                </p>
              </div>
              <div class="col-md-6">
                <p>
                  <span class="info-label">CMND/CCCD:</span>
                  <span class="info-value"
                    ><%= patient.guardianIDNumber || 'Không có' %></span
                  >
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Lịch sử khám bệnh -->
    <div class="row">
      <div class="col-sm-12">
        <div class="card">
          <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
              <h5>
                <i class="feather icon-activity mr-2"></i>Lịch sử khám bệnh
              </h5>
              <a
                href="/doctor/medical-records/create?patientId=<%= patient._id %>"
                class="btn btn-sm btn-success"
                >Tạo bệnh án mới</a
              >
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table
                class="table table-striped table-bordered align-middle table-black-bordered"
              >
                <thead class="table-dark">
                  <tr>
                    <th>Mã Bệnh Án</th>
                    <th>Ngày Khám</th>
                    <th>Bác sĩ</th>
                    <th>Chẩn đoán</th>
                    <th>Hành động</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (medicalRecords.length === 0) { %>
                  <tr>
                    <td colspan="5" class="text-center">
                      Chưa có bệnh án nào.
                    </td>
                  </tr>
                  <% } else { %> <% medicalRecords.forEach(record => { %>
                  <tr>
                    <td><%= record.recordCode || 'Không có' %></td>
                    <td><%= record.visitDate.toLocaleDateString('vi-VN') %></td>
                    <td><%= record.doctorID.fullname %></td>
                    <td><%= record.diagnosis || 'Chưa có chẩn đoán' %></td>
                    <td>
                      <a
                        href="/doctor/medical-record/<%= record._id %>"
                        class="btn btn-sm btn-info"
                        >Xem chi tiết</a
                      >
                    </td>
                  </tr>
                  <% }) %> <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('./partials/footer') %>
