<%- include('./partials/header') %>

<div class="pcoded-main-container">
  <div class="pcoded-content">
    <div class="page-header">
      <div class="page-block">
        <div class="row align-items-center">
          <div class="col-md-12">
            <div class="page-header-title">
              <h5 class="m-b-10">Chỉnh sửa bệnh án: <%= record.recordCode %></h5>
            </div>
            <ul class="breadcrumb">
              <li class="breadcrumb-item">
                <a href="/doctor"><i class="feather icon-home"></i></a>
              </li>
              <li class="breadcrumb-item">
                <a href="/doctor/patient/<%= record.patientID._id %>">Bệnh nhân: <%= record.patientID.fullname %></a>
              </li>
              <li class="breadcrumb-item"><a>Chi tiết bệnh án</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    

      <form method="POST" action="/doctor/medical-records/edit/<%= record._id %>">
        <!-- Thông tin chung -->
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h5><i class="feather icon-file-text mr-2"></i>Thông tin chung</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <p><strong>Mã bệnh án:</strong> <%= record.recordCode %></p>
                <input type="hidden" name="recordCode" value="<%= record.recordCode %>"/>
                <p>
                  <strong>Bệnh nhân:</strong>
                  <a href="/doctor/patient/<%= record.patientID._id %>">
                    <%= record.patientID.fullname %>(<%=record.patientID.patientCode %>)</a>
                </p>
                <input type="hidden" name="patientCode" value="<%= record.patientID.patientCode %>"/>
              </div>
              <div class="col-md-6">
                <p>
                  <strong>Ngày khám:</strong> <%=record.visitDate.toLocaleDateString('vi-VN') %>
                </p>
                <p><strong>Bác sĩ:</strong> <%= record.doctorID.fullname %></p>
              </div>
            </div>
          </div>
        </div>
        <!-- Chi tiết khám bệnh -->
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">
              <h5>
                <i class="feather icon-activity mr-2"></i>Chi tiết khám bệnh
              </h5>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label for="reasonForVisit"><strong>Lý do khám:</strong></label>
                <textarea class="form-control" id="reasonForVisit" name="reasonForVisit" rows="2"><%= record.reasonForVisit %></textarea>
              </div>
              <div class="form-group">
                <label for="symptoms"><strong>Triệu chứng (cách nhau bởi dấu phẩy):</strong></label>
                <input type="text" class="form-control" id="symptoms" name="symptoms" value="<%= record.symptoms.join(', ') %>">
              </div>
              <div class="form-group">
                <label for="diagnosis"><strong>Chẩn đoán:</strong></label>
                <textarea class="form-control" id="diagnosis" name="diagnosis" rows="2"><%= record.diagnosis %></textarea>
              </div>
              <div class="form-group">
                <label for="notes"><strong>Ghi chú của bác sĩ:</strong></label>
                <textarea class="form-control" id="notes" name="notes" rows="3"><%= record.notes || '' %></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Thông tin y tế cơ bản -->
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">
              <h5>
                <i class="feather icon-heart mr-2"></i>Thông tin y tế cơ bản
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-3 form-group">
                  <label for="height"><strong>Chiều cao (cm):</strong></label>
                  <input type="number" class="form-control" id="height" name="height" value="<%= record.vitalSigns.height || '' %>">
                </div>
                <div class="col-md-3 form-group">
                  <label for="weight"><strong>Cân nặng (kg):</strong></label>
                  <input type="number" class="form-control" id="weight" name="weight" value="<%= record.vitalSigns.weight || '' %>">
                </div>
                <div class="col-md-2 form-group">
                  <label for="temperature"><strong>Nhiệt độ (°C):</strong></label>
                  <input type="number" step="0.1" class="form-control" id="temperature" name="temperature" value="<%= record.vitalSigns.temperature || '' %>">
                </div>
                <div class="col-md-2 form-group">
                  <label for="bloodPressure"><strong>Huyết áp:</strong></label>
                  <input type="text" class="form-control" id="bloodPressure" name="bloodPressure" value="<%= record.vitalSigns.bloodPressure || '' %>">
                </div>
                <div class="col-md-2 form-group">
                  <label for="pulse"><strong>Nhịp tim (bpm):</strong></label>
                  <input type="number" class="form-control" id="pulse" name="pulse" value="<%= record.vitalSigns.pulse || '' %>">
                </div>
              </div>
            </div>
          </div>
        </div>

      <!-- Đơn thuốc -->
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h5><i class="feather icon-thermometer mr-2"></i>Đơn thuốc</h5>
          </div>
          <div class="card-body">
            <% if (record.prescribedMedications &&
            record.prescribedMedications.length > 0) { %>
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead class="table-light">
                  <tr>
                    <th>Tên thuốc</th>
                    <th>Liều lượng</th>
                    <th>Tần suất</th>
                    <th>Thời gian</th>
                  </tr>
                </thead>
                <tbody>
                  <% record.prescribedMedications.forEach(med => { %>
                  <tr>
                    <td><%= med.name %></td>
                    <td><%= med.dosage %></td>
                    <td><%= med.frequency %></td>
                    <td><%= med.duration %></td>
                  </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>
            <% } else { %>
            <p>Không có đơn thuốc.</p>
            <% } %>
          </div>
        </div>
      </div>

        <!-- Tái khám -->
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">
              <h5>
                <i class="feather icon-calendar mr-2"></i>Thông tin tái khám
              </h5>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label for="followUpDate"><strong>Ngày hẹn tái khám:</strong></label>
                <input type="date" class="form-control" id="followUpDate" name="followUpDate" value="<%= record.followUpDate ? record.followUpDate.toISOString().split('T')[0] : '' %>">
              </div>
              <div class="form-group">
                <label for="followUpNote"><strong>Ghi chú tái khám:</strong></label>
                <textarea class="form-control" id="followUpNote" name="followUpNote" rows="3"><%= record.followUpNote || '' %></textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-12 text-right">
          <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
        </div>
      </form>
    </div>
  </div>
</div>


<%- include('./partials/footer'); -%>
